@model ZatcaEGS.Models.DeviceSetup

@{
    ViewData["Title"] = "Device Setup";
}

<div class="col-md-10 offset-md-1">

    <div class="card" id="wizardProfile">

        <form id="deviceSetupForm" asp-action="Finish" method="post">

            <div class="card-header text-center">
                <h4 class="card-title">Manager to Zatca eInvoice Generation System</h4>
                <h5 class="card-description">Device Setup</h5>
            </div>
            <div class="wizard-navigation" id="wizardNav">
                <ul class="nav nav-pills nav-fill gap-3 p-2 small bg-transparent rounded-1 shadow-sm" id="pillNav2" role="tablist" style="--bs-nav-pills-link-active-bg: var(--bs-tertiary-bg); --bs-nav-link-color: var(--bs-secondary);">
                    <li class="nav-item">
                        <a class="nav-link rounded-5 active" data-bs-toggle="pill" href="#managerDataField" role="tab">Manager Data Fields</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link rounded-5" data-bs-toggle="pill" href="#businessInfo" role="tab">Business Info</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link rounded-5" data-bs-toggle="pill" href="#csrConfig" role="tab">CSR Configuration</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link rounded-5" data-bs-toggle="pill" href="#registerDevice" role="tab">Register Device</a>
                    </li>
                </ul>
            </div>

            <div class="card-body">
                <div class="tab-content">
                    <div class="tab-pane fade active show" id="managerDataField" role="tabpanel">
                        @* <h5 class="info-text">Manager Data Field</h5> *@
                        <div class="row text-start">
                            <!-- form content -->


                            <div class="col-md-6 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="InvoiceSubTypeGuid">Invoice Subtype GUID</label>
                                    <input asp-for="InvoiceSubTypeGuid" class="form-control form-control-sm" readonly="@Model.IsRegistered()" />
                                    <span asp-validation-for="InvoiceSubTypeGuid" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="ItemTaxCategoryGuid">Item Tax Category GUID</label>
                                    <input asp-for="ItemTaxCategoryGuid" class="form-control form-control-sm" readonly="@Model.IsRegistered()" />
                                    <span asp-validation-for="ItemTaxCategoryGuid" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="PaymentMeansCodeGuid">Payment Means Code GUID</label>
                                    <input asp-for="PaymentMeansCodeGuid" class="form-control form-control-sm" readonly="@Model.IsRegistered()" />
                                    <span asp-validation-for="PaymentMeansCodeGuid" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="InstructionNoteGuid">Instruction Note GUID</label>
                                    <input asp-for="InstructionNoteGuid" class="form-control form-control-sm" readonly="@Model.IsRegistered()" />
                                    <span asp-validation-for="InstructionNoteGuid" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="PartyTaxInfoGuid">Party Tax Info GUID</label>
                                    <input asp-for="PartyTaxInfoGuid" class="form-control form-control-sm" readonly="@Model.IsRegistered()" />
                                    <span asp-validation-for="PartyTaxInfoGuid" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="QrCodeGuid">QR Code GUID</label>
                                    <input asp-for="QrCodeGuid" class="form-control form-control-sm" readonly="@Model.IsRegistered()" />
                                    <span asp-validation-for="QrCodeGuid" class="text-danger"></span>
                                </div>
                            </div>


                            <div class="col-md-12 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="AccessToken">Api Access Token</label>
                                    <input asp-for="AccessToken" class="form-control form-control-sm" autocomplete="off" readonly="@Model.IsRegistered()" />
                                    <span asp-validation-for="AccessToken" class="text-danger"></span>
                                </div>
                            </div>


                        </div>
                    </div>

                    <input type="hidden" asp-for="RowId" />

                    <div class="tab-pane fade" id="businessInfo" role="tabpanel">
                        @* <h5 class="info-text">Business Info</h5> *@
                        <div class="row text-start">
                            <!-- form content -->

                            <div class="col-md-12 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="RegistrationName">Registration Name</label>
                                    <input asp-for="RegistrationName" class="form-control form-control-sm" readonly="@Model.IsRegistered()" />
                                    <span asp-validation-for="RegistrationName" class="text-danger"></span>
                                </div>
                            </div>


                            <div class="col-md-3 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="CompanyID">Company ID</label>
                                    <input asp-for="CompanyID" class="form-control form-control-sm" readonly="@Model.IsRegistered()" />
                                    <span asp-validation-for="CompanyID" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-md-3 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="TaxSchemeID">Tax Scheme ID</label>
                                    <input asp-for="TaxSchemeID" class="form-control form-control-sm" readonly="@Model.IsRegistered()" />
                                    <span asp-validation-for="TaxSchemeID" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-md-3 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="IdentificationID">Business Identification ID</label>
                                    <input asp-for="IdentificationID" class="form-control form-control-sm" readonly="@Model.IsRegistered()" />
                                    <span asp-validation-for="IdentificationID" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-md-3 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="IdentificationScheme">Identification Scheme</label>
                                    <input asp-for="IdentificationScheme" class="form-control form-control-sm" readonly="@Model.IsRegistered()" />
                                    <span asp-validation-for="IdentificationScheme" class="text-danger"></span>
                                </div>
                            </div>



                            <div class="col-md-12 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="StreetName">Street Name</label>
                                    <input asp-for="StreetName" class="form-control form-control-sm" readonly="@Model.IsRegistered()" />
                                    <span asp-validation-for="StreetName" class="text-danger"></span>
                                </div>
                            </div>


                            <div class="col-md-6 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="CitySubdivisionName">City Subdivision Name</label>
                                    <input asp-for="CitySubdivisionName" class="form-control form-control-sm" readonly="@Model.IsRegistered()" />
                                    <span asp-validation-for="CitySubdivisionName" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="CityName">City Name</label>
                                    <input asp-for="CityName" class="form-control form-control-sm" readonly="@Model.IsRegistered()" />
                                    <span asp-validation-for="CityName" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-md-3 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="BuildingNumber">Building Number</label>
                                    <input asp-for="BuildingNumber" class="form-control form-control-sm" readonly="@Model.IsRegistered()" />
                                    <span asp-validation-for="BuildingNumber" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-md-3 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="PostalZone">Postal Zone</label>
                                    <input asp-for="PostalZone" class="form-control form-control-sm" readonly="@Model.IsRegistered()" />
                                    <span asp-validation-for="PostalZone" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-md-3 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="CountryIdentificationCode">Country Identification Code</label>
                                    <input asp-for="CountryIdentificationCode" class="form-control form-control-sm" readonly="@Model.IsRegistered()" />
                                    <span asp-validation-for="CountryIdentificationCode" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-md-3 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="BusinessCategory">Business Category</label>
                                    <input asp-for="BusinessCategory" class="form-control form-control-sm" readonly="@Model.IsRegistered()" />
                                    <span asp-validation-for="BusinessCategory" class="text-danger"></span>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="tab-pane fade" id="csrConfig" role="tabpanel">
                        @* <h5 class="info-text">CSR Configuration</h5> *@
                        <div class="row text-start">
                            <!-- form content -->
                            <div class="col-md-3 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="CsrIndustryBusinessCategory"></label>
                                    <input asp-for="CsrIndustryBusinessCategory" class="form-control form-control-sm" readonly />
                                </div>
                            </div>
                            

                            <div class="col-md-3 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="CsrCommonName"></label>
                                    <input asp-for="CsrCommonName" class="form-control form-control-sm" readonly />
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="CsrSerialNumber"></label>
                                    <input asp-for="CsrSerialNumber" class="form-control form-control-sm" readonly />
                                </div>
                            </div>

                            <div class="col-md-3 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="CsrOrganizationIdentifier"></label>
                                    <input asp-for="CsrOrganizationIdentifier" class="form-control form-control-sm" readonly />
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="CsrOrganizationUnitName"></label>
                                    <input asp-for="CsrOrganizationUnitName" class="form-control form-control-sm" readonly />
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="CsrOrganizationName"></label>
                                    <input asp-for="CsrOrganizationName" class="form-control form-control-sm" readonly />
                                </div>
                            </div>


                            <div class="col-md-3 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="CsrCountryName"></label>
                                    <input asp-for="CsrCountryName" class="form-control form-control-sm" readonly />
                                </div>
                            </div>

                            <div class="col-md-3 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="CsrInvoiceType"></label>
                                    <input asp-for="CsrInvoiceType" class="form-control form-control-sm" readonly />
                                </div>
                            </div>

                            <div class="col-md-3 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="CsrLocationAddress"></label>
                                    <input asp-for="CsrLocationAddress" class="form-control form-control-sm" readonly />
                                </div>
                            </div>

                            <div class="col-md-3 mb-3">
                                <div class="form-group">
                                    <label style="color: var(--bs-success);" class="form-label" asp-for="CsrType">Select CSR Type</label>
                                    <select asp-for="CsrType" class="form-control form-control-sm" disabled="@Model.IsRegistered()">
                                        @foreach (var value in Enum.GetValues(typeof(EnumCsrType)))
                                        {
                                            <option value="@value">@value</option>
                                        }
                                    </select>
                                </div>
                            </div>


                            @if (!@Model.IsRegistered())
                            {
                                <div class="col-md-12 mb-3 text-end">
                                    <button type="button" id="generateCSRButton" class="btn btn-outline-success btn-sm" disabled="@Model.IsRegistered()"> Generate CSR</button>
                                </div>
                            }

                            <div class="col-md-12 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="GeneratedCSR">Generated CSR</label>
                                    <textarea id="GeneratedCSR" asp-for="GeneratedCSR" class="form-control form-control-sm" readonly></textarea>
                                </div>
                            </div>

                            <div class="col-md-12 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="EcSecp256k1Privkeypem">Generated EC Secp256k1 Private Key (PEM)</label>
                                    <textarea id="EcSecp256k1Privkeypem" asp-for="EcSecp256k1Privkeypem" class="form-control form-control-sm" readonly></textarea>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="tab-pane fade" id="registerDevice" role="tabpanel">
                        @*  <h5 class="info-text">Register Device</h5> *@
                        <div class="row text-start">

                            <!-- Form content -->
                            <div id="urlContainer" class="@(Model.IsRegistered() ? "col-md-12" : "col-md-10")">
                                <!-- Compliance CSID Url -->
                                <div class="input-group input-group-sm mt-0">
                                    <span class="input-group-text" asp-for="ComplianceCSIDUrl">Compliance CSID URL</span>
                                    <input type="text" asp-for="ComplianceCSIDUrl" class="form-control" readonly="@Model.IsRegistered()">
                                </div>

                                <!-- Obboarding PCSID Url -->
                                <div class="input-group input-group-sm mt-1">
                                    <span class="input-group-text" asp-for="ProductionCSIDUrl">Production CSID URL</span>
                                    <input type="text" asp-for="ProductionCSIDUrl" class="form-control" readonly="@Model.IsRegistered()">
                                </div>

                                <!-- Compliance Check URL -->
                                <div class="input-group input-group-sm mt-1">
                                    <span class="input-group-text" asp-for="ComplianceCheckUrl">Compliance Check URL</span>
                                    <input type="text" asp-for="ComplianceCheckUrl" class="form-control">
                                    <span asp-validation-for="ComplianceCheckUrl" class="text-danger"></span>
                                </div>

                                <!-- Reporting URL -->
                                <div class="input-group input-group-sm mt-1">
                                    <span class="input-group-text" asp-for="ReportingUrl">Reporting URL</span>
                                    <input type="text" asp-for="ReportingUrl" class="form-control">
                                    <span asp-validation-for="ReportingUrl" class="text-danger"></span>
                                </div>

                                <!-- Clearance URL -->
                                <div class="input-group input-group-sm mt-1">
                                    <span class="input-group-text" asp-for="ClearanceUrl">Clearance URL</span>
                                    <input type="text" asp-for="ClearanceUrl" class="form-control">
                                    <span asp-validation-for="ClearanceUrl" class="text-danger"></span>
                                </div>
                            </div>

                            <!-- Middle-center align OTP-->
                            <div id="onboardingContainer" class="col-md-2 d-flex flex-column justify-content-center" style="padding-block-start: 5px; border-left: 1px solid var(--bs-border-color-translucent);">
                                <div class="form-group mb-3 text-center">
                                    <label class="form-label">CCSID OTP</label>
                                    <input type="text" id="CCSIDOTP" class="form-control form-control-sm text-center" readonly="@Model.IsRegistered()">
                                </div>
                                <div class="d-flex justify-content-center">
                                    <button id="ccsidButton" type="button" disabled="@Model.IsRegistered()" class="btn btn-outline-warning btn-sm">Get CCSID & PCSID</button>
                                </div>
                            </div>


                            <!-- Additional form content -->
                            <div class="col-md-12 mb-3 mt-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="CCSIDBinaryToken">CCSID Binary Token</label>
                                    <textarea asp-for="CCSIDBinaryToken" class="form-control form-control-sm" readonly></textarea>
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="CCSIDSecret">CCSID Secret</label>
                                    <input asp-for="CCSIDSecret" class="form-control form-control-sm" readonly />
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="CCSIDComplianceRequestId">CCSID Compliance Request ID</label>
                                    <input asp-for="CCSIDComplianceRequestId" class="form-control form-control-sm" readonly />
                                </div>
                            </div>

                            <div class="col-md-12 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="PCSIDBinaryToken">PCSID Binary Token</label>
                                    <textarea asp-for="PCSIDBinaryToken" class="form-control form-control-sm" readonly></textarea>
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <div class="form-group">
                                    <label class="form-label" asp-for="PCSIDSecret">PCSID Secret</label>
                                    <input asp-for="PCSIDSecret" class="form-control form-control-sm" readonly />
                                </div>
                            </div>

                            <div class="col-md-3 mb-3">
                                <div class="form-group">
                                    <label class="form-label text-center" asp-for="RegisteredDate">Registered Date</label>
                                    <input asp-for="RegisteredDate" class="form-control form-control-sm" readonly />
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
            </div>
            <div class="card-footer">
                <button type="button" class="btn btn-outline-secondary btn-sm" name="previous">Previous</button>

                @if (@Model.IsRegistered()){
                    <button type="button" class="btn btn-outline-warning btn-sm" name="editCustomField">Edit CustomFields</button>
                }

                <button type="button" class="btn btn-outline-secondary btn-sm ml-auto" name="next">Next</button>
                <button type="submit" class="btn btn-outline-primary btn-sm" name="finish">Finish</button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        $(function () {
            var $tabs = $('.tab-pane');
            var $navLinks = $('#wizardNav .nav-link');
            var currentIndex = 0;

            function updateButtons() {
                $('[name="previous"]').toggleClass('d-none', currentIndex === 0);
                $('[name="editCustomField"]').toggleClass('d-none', currentIndex !== 0);

                $('[name="next"]').toggleClass('d-none', currentIndex === $tabs.length - 1);
                $('[name="finish"]').toggleClass('d-none', currentIndex !== $tabs.length - 1);
                $navLinks.removeClass('active');
                $navLinks.eq(currentIndex).addClass('active');
            }

            function handleTabShown(tabId) {
                if (tabId === "csrConfig") {
                    var identificationIdValue = $("#IdentificationID").val();

                    // Autofill CSR Common Name
                    if (identificationIdValue) {
                        var csrCommonName = "MGR - " + identificationIdValue + " - " + $("#CompanyID").val();
                        $("#CsrCommonName").val(csrCommonName);
                    }

                    // Autofill CSR Serial Number
                    var csrSerialNumberInput = $("#CsrSerialNumber").val();
                    var guidPattern = /\b[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}\b/;

                    if (!csrSerialNumberInput || !guidPattern.test(csrSerialNumberInput)) {
                        var uuid = uuidv4(); // Function to generate a UUID
                        var csrSerialNumber = "1-MGR|2-MGR|3-" + uuid;
                        $("#CsrSerialNumber").val(csrSerialNumber);
                    }

                    $("#CsrOrganizationIdentifier").val($("#CompanyID").val());
                    $("#CsrOrganizationUnitName").val($("#CityName").val());
                    $("#CsrOrganizationName").val($("#RegistrationName").val());
                    $("#CsrCountryName").val($("#CountryIdentificationCode").val());
                    $("#CsrInvoiceType").val("1100");
                    $("#CsrLocationAddress").val($("#PostalZone").val());
                    $("#CsrIndustryBusinessCategory").val($("#BusinessCategory").val());
                }
            }

            $('[name="editCustomField"]').on('click', function () {
                $('#managerDataField input').removeAttr('readonly'); // Remove readonly attribute from all inputs inside the tab
                $(this).remove(); // Remove the Edit CustomFields button
            });

            $('[name="next"]').on('click', function () {
                if (currentIndex < $tabs.length - 1) {
                    $tabs.eq(currentIndex).removeClass('active show');
                    currentIndex++;
                    $tabs.eq(currentIndex).addClass('active show');
                    handleTabShown($navLinks.eq(currentIndex).attr("href").substring(1));
                    updateButtons();
                }
            });

            $('[name="previous"]').on('click', function () {
                if (currentIndex > 0) {
                    $tabs.eq(currentIndex).removeClass('active show');
                    currentIndex--;
                    $tabs.eq(currentIndex).addClass('active show');
                    handleTabShown($navLinks.eq(currentIndex).attr("href").substring(1));
                    updateButtons();
                }
            });

            $navLinks.on('click', function (e) {
                e.preventDefault();
                var target = $(this).attr('href');
                currentIndex = $navLinks.index(this);
                $tabs.removeClass('active show');
                $(target).addClass('active show');
                handleTabShown(target.substring(1));
                updateButtons();
            });

            // Function to generate UUID (v4)
            function uuidv4() {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            }


            $('#generateCSRButton').on('click', function () {
                var csrData = {
                    CommonName: $('#CsrCommonName').val(),
                    SerialNumber: $('#CsrSerialNumber').val(),
                    OrganizationIdentifier: $('#CsrOrganizationIdentifier').val(),
                    OrganizationUnitName: $('#CsrOrganizationUnitName').val(),
                    OrganizationName: $('#CsrOrganizationName').val(),
                    CountryName: $('#CsrCountryName').val(),
                    InvoiceType: $('#CsrInvoiceType').val(),
                    LocationAddress: $('#CsrLocationAddress').val(),
                    IndustryBusinessCategory: $('#CsrIndustryBusinessCategory').val()
                };

                if (!csrData.CommonName ||
                    !csrData.SerialNumber ||
                    !csrData.OrganizationIdentifier ||
                    !csrData.OrganizationUnitName ||
                    !csrData.OrganizationName ||
                    !csrData.CountryName ||
                    !csrData.InvoiceType ||
                    !csrData.LocationAddress ||
                    !csrData.IndustryBusinessCategory) {
                    alert("Please provide all required inputs.");
                    return;
                }

                $.ajax({
                    url: '/generatecsr',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(csrData),
                    success: function (response) {
                        $('#GeneratedCSR').val(response.csr);
                        $('#EcSecp256k1Privkeypem').val(response.privateKey);

                        checkGeneratedCSR();
                        alert('CSR berhasil di-generate!');
                    },
                    error: function (xhr) {
                        var errorResponse = JSON.parse(xhr.responseText);
                        var errorMessage = 'Errors:\n' + errorResponse.errors.join('\n');
                        alert(errorMessage);
                    }
                });
            });

            
            $("#ccsidButton").on('click', function () {
                var formData = new FormData($('#deviceSetupForm')[0]);
                formData.append('OTP', $("#CCSIDOTP").val()); 

                if (!formData.get('GeneratedCSR') || !formData.get('ComplianceCSIDUrl') || !formData.get('ProductionCSIDUrl') || !formData.get('OTP')) {
                    alert("Please provide all required inputs.");
                    return;
                }

                $.ajax({
                    url: '@Url.Action("GetCCSID", "Wizard")',
                    type: 'POST',
                    processData: false,
                    contentType: false,
                    data: formData,
                    success: function (response) {

                        $("#CCSIDBinaryToken").val(response.ccsidBinaryToken);
                        $("#CCSIDSecret").val(response.ccsidSecret);
                        $("#CCSIDComplianceRequestId").val(response.ccsidComplianceRequestId);
                        $("#PCSIDBinaryToken").val(response.pcsidBinaryToken);
                        $("#PCSIDSecret").val(response.pcsidSecret);
                        $("#RegisteredDate").val(response.registeredDate);

                        alert('Device Registered Successfully!');

                        checkOnboardingContainer();
                    },
                    error: function (xhr, status, error) {
                        alert("Error: " + xhr.responseText);
                    }
                });
            });


            function checkGeneratedCSR() {
                var generatedCSR = $("#GeneratedCSR").val();
                var privateKey = $("#EcSecp256k1Privkeypem").val();

                if (generatedCSR && privateKey) {
                    $("#generateCSRButton").addClass("d-none");
                } else {
                    $("#generateCSRButton").removeClass("d-none");
                }
            }

            function checkOnboardingContainer() {
                var cCSIDBinaryToken = $("#CCSIDBinaryToken").val();
                var pCSIDBinaryToken = $("#PCSIDBinaryToken").val();

                if (cCSIDBinaryToken && pCSIDBinaryToken) {
                    $("#onboardingContainer").addClass("d-none");
                    $("#urlContainer").removeClass("col-md-10").addClass("col-md-12");
                } else {
                    $("#onboardingContainer").removeClass("d-none");
                    $("#urlContainer").removeClass("col-md-12").addClass("col-md-10");
                }
            }

            $("#CCSIDBinaryToken, #PCSIDBinaryToken").on('input', function () {
                checkOnboardingContainer();
            });

            $("#GeneratedCSR, #EcSecp256k1Privkeypem").on('input', function () {
                checkGeneratedCSR();
            });

            // Initial setup
            updateButtons();
            handleTabShown($navLinks.eq(currentIndex).attr("href").substring(1));
            checkGeneratedCSR();
            checkOnboardingContainer();

        });
    </script>
}

